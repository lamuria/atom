{"version":1,"windowDimensions":{"x":0,"y":0,"width":1280,"height":800,"maximized":true},"grammars":{"grammarOverridesByPath":{}},"project":{"deserializer":"Project","paths":["/Users/marcoslamuria/Documents/rupeal/clanhr/directory-api"],"buffers":[{"id":"adb9fcd6327fd807e7d9558d771e26f2","text":"(ns clanhr.directory-api.core.login\n  (require [clanhr.auth.core :as auth]\n           [clanhr.directory-api.gateways.user-gateway :as user-gateway]\n           [clanhr.directory-api.gateways.account-gateway :as account-gateway]\n           [clanhr.directory-api.models.user :as user-model]\n           [clanhr.directory-api.models.account :as account-model]\n           [clanhr.directory-api.lib.analytics :as analytics]\n           [clanhr.directory-api.core.generate-token-to-user :as generate-token]\n           [clanhr.directory-api.core.salt-user-hash :as user-salt]\n           [result.core :as result]))\n\n(defn find-account\n  [user]\n  (let [account (account-gateway/find-by-id (user-model/account user))]\n    (account-model/setup-default-settings account)))\n\n(defn clean-user\n  \"Remove passwords\"\n  [user]\n  (user-model/clean (generate-token/run user)))\n\n(defn authenticate\n  \"authenticate user\"\n  [user input-data]\n  (if (and (= (user-model/email user) (:email input-data))\n           (user-salt/verified? user (:password input-data)))\n    (let [clean-user (clean-user user)\n          account (find-account clean-user)]\n      (analytics/identify! user)\n      (analytics/login! user)\n      (result/success {:user clean-user\n                       :account account}))\n    (result/failure {:errors [\"invalid-email-or-password\"]})))\n\n(defn run\n  \"Perform run\"\n  [data]\n  (let [email (:email data)\n        password (:password data)\n        user (user-gateway/find-by-email email)]\n    (cond\n      (and (empty? email) (empty? password))\n        (result/failure {:errors [\"email-required\" \"password-required\"]})\n      (empty? email)\n        (result/failure {:errors [\"email-required\"]})\n      (empty? password)\n        (result/failure {:errors [\"password-required\"]})\n      (not-empty user)\n        (authenticate user data)\n      :else\n        (result/failure {:errors [\"invalid-email-or-password\"]}))))\n","defaultMarkerLayerId":"0","markerLayers":{"0":{"id":"0","maintainHistory":false,"markersById":{},"version":2},"4":{"id":"4","maintainHistory":false,"markersById":{},"version":2},"6":{"id":"6","maintainHistory":false,"markersById":{},"version":2},"7":{"id":"7","maintainHistory":false,"markersById":{},"version":2},"10":{"id":"10","maintainHistory":false,"markersById":{},"version":2},"11":{"id":"11","maintainHistory":true,"markersById":{"86":{"range":{"start":{"row":25,"column":35},"end":{"row":25,"column":35}},"properties":{"type":"selection","goalScreenRange":null,"preserveFolds":true,"autoscroll":false},"reversed":false,"tailed":false,"valid":true,"invalidate":"never"}},"version":2},"13":{"id":"13","maintainHistory":false,"markersById":{},"version":2},"36":{"id":"36","maintainHistory":false,"markersById":{},"version":2}},"nextMarkerLayerId":37,"history":{"version":3,"nextCheckpointId":2,"undoStack":[],"redoStack":[{"type":"group-end","snapshot":{"2":{"1":{"range":[[50,0],[50,0]],"properties":{"type":"selection","goalScreenRange":null,"preserveFolds":true,"autoscroll":false},"reversed":false,"tailed":false,"valid":true,"invalidate":"never"}}}},{"type":"change","content":{"oldRange":[[50,0],[51,0]],"newRange":[[50,0],[50,0]],"oldText":"        (result/failure {:errors [\"invalid-email-or-password\"]}))))\n","newText":""}},{"type":"group-start","snapshot":{"2":{"1":{"range":[[50,0],[51,0]],"properties":{"type":"selection","goalScreenRange":null,"preserveFolds":true,"autoscroll":false},"reversed":false,"tailed":true,"valid":true,"invalidate":"never"}}}}]},"encoding":"utf8","filePath":"/Users/marcoslamuria/Documents/rupeal/clanhr/directory-api/src/clanhr/directory_api/core/login.clj","digestWhenLastPersisted":"6a892cb99f7bc222029e9a70366325234871e378","preferredLineEnding":null,"nextMarkerId":95,"deserializer":"TextBuffer","version":5}]},"workspace":{"deserializer":"Workspace","paneContainer":{"deserializer":"PaneContainer","version":1,"root":{"deserializer":"Pane","id":82,"items":[{"deserializer":"TextEditor","id":79,"softTabs":true,"firstVisibleScreenRow":13,"firstVisibleScreenColumn":0,"displayBuffer":{"deserializer":"DisplayBuffer","id":78,"softWrapped":false,"tokenizedBuffer":{"deserializer":"TokenizedBuffer","bufferPath":"/Users/marcoslamuria/Documents/rupeal/clanhr/directory-api/src/clanhr/directory_api/core/login.clj","bufferId":"adb9fcd6327fd807e7d9558d771e26f2","tabLength":2,"largeFileMode":false},"largeFileMode":false,"foldsMarkerLayerId":"10"},"selectionsMarkerLayerId":"11"}],"activeItemURI":"/Users/marcoslamuria/Documents/rupeal/clanhr/directory-api/src/clanhr/directory_api/core/login.clj","focused":true,"flexScale":1},"activePaneId":82},"packagesWithActiveGrammars":["language-clojure","language-hyperlink","language-todo"],"destroyedItemURIs":["/Users/marcoslamuria/.atom/storage/application.json","/Users/marcoslamuria/.atom/storage/editor-3b56e1e3dee1b64f7ee96d875a3206b415f7b0ff","/Users/marcoslamuria/.atom/storage/editor-2b0e512a126f32a1b5cd53693b5cb7702099c98f","/Users/marcoslamuria/.atom/packages/ex-mode/LICENSE.md","/Users/marcoslamuria/.atom/packages/ex-mode/CHANGELOG.md","/Users/marcoslamuria/.atom/packages/ex-mode/package.json","/Users/marcoslamuria/.atom/packages/ex-mode/lib/command-error.coffee","/Users/marcoslamuria/.atom/packages/ex-mode/lib/command.coffee","/Users/marcoslamuria/.atom/packages/ex-mode/lib/ex-mode.coffee","/Users/marcoslamuria/.atom/packages/ex-mode/lib/ex-normal-mode-input-element.coffee","/Users/marcoslamuria/.atom/packages/ex-mode/lib/ex-state.coffee","/Users/marcoslamuria/.atom/packages/ex-mode/lib/ex-view-model.coffee","/Users/marcoslamuria/.atom/packages/ex-mode/lib/ex.coffee","/Users/marcoslamuria/.atom/packages/ex-mode/lib/find.coffee","/Users/marcoslamuria/.atom/packages/ex-mode/lib/vim-option.coffee","/Users/marcoslamuria/.atom/packages/ex-mode/keymaps/ex-mode.cson","/Users/marcoslamuria/.atom/styles.less","/Users/marcoslamuria/.atom/.apm/.apmrc","/Users/marcoslamuria/.atom/.git/description","/Users/marcoslamuria/.atom/.git/HEAD","/Users/marcoslamuria/.atom/.git/packed-refs","/Users/marcoslamuria/.atom/.git/config","/Users/marcoslamuria/.atom/.git/hooks/update.sample","/Users/marcoslamuria/.atom/blob-store/BLOB","/Users/marcoslamuria/.atom/blob-store/INVKEYS","/Users/marcoslamuria/.atom/blob-store/MAP","/Users/marcoslamuria/.atom/compile-cache/02d869a67efd02fbb0b443ae1bd4e84d37b10f5f.json","/Users/marcoslamuria/.atom/compile-cache/4987a5a8a93a1205c7b53df4c0cc572d8ceab3cf.json","/Users/marcoslamuria/.atom/compile-cache/94351d0b08e9dacc79d087c1060552fcd082269b.json","/Users/marcoslamuria/.atom/packages/linter-clojure/README.md","/Users/marcoslamuria/.atom/compile-cache/c3d844bcee7023858d78e750546f1d481c18af45.json","/Users/marcoslamuria/.atom/config.cson","atom://config","/Users/marcoslamuria/Documents/rupeal/clanhr/directory-api/src/clanhr/directory_api/core/login.clj","/Users/marcoslamuria/Documents/rupeal/clanhr/directory-api/src/clanhr/directory_api/core/login.clj","/Users/marcoslamuria/Documents/rupeal/clanhr/directory-api/src/clanhr/directory_api/core/login.clj","/Users/marcoslamuria/Documents/rupeal/clanhr/directory-api/src/clanhr/directory_api/core/login.clj","/Users/marcoslamuria/Documents/rupeal/clanhr/directory-api/src/clanhr/directory_api/core/login.clj"]},"packageStates":{"linter":{"scope":"File"},"proto-repl":{},"fuzzy-finder":{"/Users/marcoslamuria/Documents/rupeal/clanhr/directory-api/src/clanhr/directory_api/core/login.clj":1458773466774},"metrics":{"sessionLength":229488},"tree-view":{"directoryExpansionStates":{"/Users/marcoslamuria/Documents/rupeal/clanhr/directory-api":{"isExpanded":true,"entries":{".git":{"isExpanded":false,"entries":{}},"migrations":{"isExpanded":false,"entries":{}},"script":{"isExpanded":false,"entries":{}},"src":{"isExpanded":false,"entries":{}},"target":{"isExpanded":false,"entries":{}},"test":{"isExpanded":false,"entries":{}}}}},"selectedPath":"/Users/marcoslamuria/Documents/rupeal/clanhr/directory-api/src","hasFocus":false,"attached":true,"scrollLeft":0,"scrollTop":0,"width":5},"keybinding-resolver":{},"find-and-replace":{"findOptions":{"findPattern":"new","replacePattern":"","pathsPattern":"","useRegex":false,"wholeWord":false,"caseSensitive":false,"inCurrentSelection":false},"findHistory":["empty","new"],"replaceHistory":[],"pathsHistory":[]}},"fullScreen":true}